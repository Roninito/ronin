<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hyprland Plugin - Skills and Duties</title>
  <link rel="stylesheet" href="../../styles/book.css">
  <!-- Prism.js Syntax Highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
</head>
<body>
  <div class="page">
    <div class="content">
      <h1>Hyprland Plugin</h1>
      
      <p class="lead">
        The Hyprland plugin enables Ronin agents to manage and configure the Hyprland 
        tiling window manager, allowing programmatic control of keybindings, configuration 
        files, and window management settings.
      </p>

      <h2>Overview</h2>
      <p>
        Hyprland is a dynamic tiling Wayland compositor. This plugin provides agents with 
        the ability to read and modify Hyprland's configuration, manage keybindings, and 
        reload the compositor - enabling automation of desktop environment customization 
        and dynamic configuration based on user needs or system state.
      </p>

      <h2>Key Features</h2>
      <ul>
        <li><strong>Configuration Reading</strong>: Parse and read Hyprland config files</li>
        <li><strong>Configuration Writing</strong>: Modify and save configuration files</li>
        <li><strong>Keybinding Management</strong>: Parse, read, and modify keyboard shortcuts</li>
        <li><strong>Live Reload</strong>: Apply configuration changes without restarting</li>
        <li><strong>Custom Paths</strong>: Support for non-standard config file locations</li>
        <li><strong>Error Handling</strong>: Clear error messages for file operations</li>
      </ul>

      <h2>Plugin Methods</h2>

      <h3>Configuration Management</h3>
      
      <h4><code>readConfig(path?)</code></h4>
      <p>Read the Hyprland configuration file. Defaults to ~/.config/hypr/hyprland.conf.</p>
      <pre><code class="language-typescript">// Read default config
const config = await this.api.hyprland?.readConfig();
console.log("Config path:", config.path);
console.log("Content:\n", config.content);

// Read from custom path
const customConfig = await this.api.hyprland?.readConfig(
  "/home/user/.config/hypr/custom.conf"
);</code></pre>

      <h4><code>writeConfig(content, path?)</code></h4>
      <p>Write content to the Hyprland configuration file.</p>
      <pre><code class="language-typescript">const newConfig = `
# My Hyprland Config
monitor=,preferred,auto,auto

# Input
input {
    kb_layout = us
    follow_mouse = 1
}

# General
general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2
}
`;

await this.api.hyprland?.writeConfig(newConfig);

// Or write to custom path
await this.api.hyprland?.writeConfig(newConfig, "/path/to/custom.conf");</code></pre>

      <h3>Keybinding Management</h3>

      <h4><code>getKeybindings(path?)</code></h4>
      <p>Parse and return all keybindings from the configuration file.</p>
      <pre><code class="language-typescript">const { keybindings } = await this.api.hyprland?.getKeybindings();

for (const binding of keybindings) {
  console.log(`${binding.key} => ${binding.action}`);
}

// Example output:
// SUPER + Return => exec kitty
// SUPER + Q => killactive
// SUPER + M => exit
// SUPER + V => togglefloating</code></pre>

      <h4><code>setKeybinding(key, action, path?)</code></h4>
      <p>Add or update a keybinding in the configuration file. Updates existing bindings or appends new ones.</p>
      <pre><code class="language-typescript">// Add new keybinding
await this.api.hyprland?.setKeybinding(
  "SUPER + E",
  "exec thunar"
);

// Update existing keybinding
await this.api.hyprland?.setKeybinding(
  "SUPER + Return",
  "exec alacritty"
);

// Add keybinding to custom config
await this.api.hyprland?.setKeybinding(
  "SUPER_SHIFT + L",
  "exec hyprlock",
  "/path/to/custom.conf"
);</code></pre>

      <h3>Configuration Reload</h3>

      <h4><code>reload()</code></h4>
      <p>Reload Hyprland configuration using hyprctl. Applies changes without restarting the compositor.</p>
      <pre><code class="language-typescript">try {
  const result = await this.api.hyprland?.reload();
  console.log("Reload successful:", result.output);
} catch (error) {
  console.error("Failed to reload:", error);
}</code></pre>

      <h2>Configuration File Structure</h2>

      <p>Hyprland configuration typically looks like this:</p>

      <pre><code class="language-typescript"># ~/.config/hypr/hyprland.conf

# Monitor configuration
monitor=DP-1,1920x1080@144,0x0,1

# Input settings
input {
    kb_layout = us
    kb_variant = 
    kb_model = 
    kb_options = 
    kb_rules = 
    follow_mouse = 1
}

# General appearance
general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
    col.inactive_border = rgba(595959aa)
}

# Decoration
decoration {
    rounding = 10
    blur {
        enabled = true
        size = 3
        passes = 1
    }
    shadow {
        enabled = true
        range = 4
        render_power = 3
    }
}

# Keybindings
bind = SUPER, Return, exec, kitty
bind = SUPER, Q, killactive
bind = SUPER, M, exit
bind = SUPER, V, togglefloating
bind = SUPER, R, exec, wofi --show drun
bind = SUPER, P, pseudo
bind = SUPER, J, togglesplit

# Mouse bindings
bindm = SUPER, mouse:272, movewindow
bindm = SUPER, mouse:273, resizewindow</code></pre>

      <h2>Keybinding Format</h2>

      <p>Keybindings in Hyprland use the following format:</p>

      <pre><code class="language-bash"># Standard keybinding
bind = MODIFIERS, KEY, ACTION, PARAMS

# Mouse binding
bindm = MODIFIERS, MOUSE_BUTTON, ACTION

# Examples:
bind = SUPER, Return, exec, kitty           # Super+Enter opens kitty
bind = SUPER_SHIFT, Q, killactive           # Super+Shift+Q kills window
bind = CTRL_ALT, T, exec, alacritty         # Ctrl+Alt+T opens alacritty
bindm = SUPER, mouse:272, movewindow        # Super+Left Click moves window</code></pre>

      <h3>Common Modifiers</h3>
      <ul>
        <li><code>SUPER</code> - Windows/Super key</li>
        <li><code>SUPER_SHIFT</code> - Super + Shift</li>
        <li><code>CTRL</code> - Control key</li>
        <li><code>ALT</code> - Alt key</li>
        <li><code>CTRL_ALT</code> - Control + Alt</li>
        <li><code>SHIFT</code> - Shift key</li>
      </ul>

      <h3>Common Actions</h3>
      <ul>
        <li><code>exec, command</code> - Execute a command</li>
        <li><code>killactive</code> - Close active window</li>
        <li><code>exit</code> - Exit Hyprland</li>
        <li><code>togglefloating</code> - Toggle floating mode</li>
        <li><code>pseudo</code> - Toggle pseudo-tiling</li>
        <li><code>workspace, N</code> - Switch to workspace N</li>
        <li><code>movetoworkspace, N</code> - Move window to workspace N</li>
        <li><code>fullscreen</code> - Toggle fullscreen</li>
      </ul>

      <h2>Example Usage</h2>

      <h3>Configuration Backup Agent</h3>
      <pre><code class="language-bash">import { BaseAgent } from "@ronin/agent/index.js";
import type { AgentAPI } from "@ronin/types/index.js";

export default class HyprlandBackupAgent extends BaseAgent {
  constructor(api: AgentAPI) {
    super(api);
  }

  async execute(): Promise<void> {
    // Read current config
    const config = await this.api.hyprland?.readConfig();
    
    // Create backup with timestamp
    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
    const backupPath = `~/.config/hypr/backups/hyprland.conf.${timestamp}`;
    
    // Ensure backup directory exists
    await this.api.shell?.exec("mkdir -p ~/.config/hypr/backups");
    
    // Write backup
    await this.api.files?.write(backupPath, config.content);
    
    console.log(`Backup created: ${backupPath}`);
  }
}</code></pre>

      <h3>Dynamic Keybinding Manager</h3>
      <pre><code class="language-bash">export default class HyprlandKeybindingAgent extends BaseAgent {
  constructor(api: AgentAPI) {
    super(api);
  }

  async execute(): Promise<void> {
    // Add productivity keybindings
    const bindings = [
      { key: "SUPER + E", action: "exec, thunar" },
      { key: "SUPER + B", action: "exec, firefox" },
      { key: "SUPER + T", action: "exec, thunderbird" },
      { key: "SUPER_SHIFT + S", action: "exec, flameshot gui" },
      { key: "SUPER_SHIFT + L", action: "exec, hyprlock" }
    ];

    for (const binding of bindings) {
      await this.api.hyprland?.setKeybinding(
        binding.key,
        binding.action
      );
      console.log(`Added: ${binding.key} => ${binding.action}`);
    }

    // Reload to apply changes
    await this.api.hyprland?.reload();
    console.log("Configuration reloaded!");
  }
}</code></pre>

      <h3>Configuration Templating</h3>
      <pre><code class="language-bash">export default class HyprlandTemplateAgent extends BaseAgent {
  constructor(api: AgentAPI) {
    super(api);
  }

  async execute(): Promise<void> {
    // Get current keybindings to preserve them
    const { keybindings } = await this.api.hyprland?.getKeybindings();
    
    // Generate new config from template
    const template = `
# Generated by Ronin
# ${new Date().toISOString()}

monitor=,preferred,auto,auto

input {
    kb_layout = us
    follow_mouse = 1
    touchpad {
        natural_scroll = no
    }
}

general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2
    col.active_border = rgba(33ccffee)
    col.inactive_border = rgba(595959aa)
    layout = dwindle
}

decoration {
    rounding = 10
    blur {
        enabled = true
        size = 3
        passes = 1
    }
}

animations {
    enabled = yes
    bezier = myBezier, 0.05, 0.9, 0.1, 1.05
    animation = windows, 1, 7, myBezier
    animation = border, 1, 10, default
    animation = fade, 1, 7, default
    animation = workspaces, 1, 6, default
}

dwindle {
    pseudotile = yes
    preserve_split = yes
}

# Preserved keybindings
${keybindings.map(k => `bind = ${k.key.replace(' + ', ', ')}, ${k.action}`).join('\n')}
`;

    // Write new config
    await this.api.hyprland?.writeConfig(template);
    
    // Reload
    await this.api.hyprland?.reload();
    
    console.log("Configuration updated from template!");
  }
}</code></pre>

      <h2>Requirements</h2>

      <ul>
        <li>Hyprland must be installed and running</li>
        <li><code>hyprctl</code> must be available in PATH</li>
        <li>User must have write permissions to config directory</li>
      </ul>

      <h2>Security Considerations</h2>
      <ul>
        <li>Configuration changes take effect immediately after reload</li>
        <li>Always backup configurations before making changes</li>
        <li>Test keybindings in a safe environment first</li>
        <li>Be careful with exit/shutdown keybindings</li>
        <li>Ensure exec commands don't introduce security vulnerabilities</li>
      </ul>

      <h2>Common Issues</h2>

      <ul>
        <li><strong>"Failed to reload"</strong>: Hyprland may not be running or hyprctl not in PATH</li>
        <li><strong>Config not found</strong>: Check if Hyprland is installed and config exists</li>
        <li><strong>Permission denied</strong>: Ensure user owns the config directory</li>
        <li><strong>Syntax errors</strong>: Invalid config syntax will be logged by Hyprland</li>
      </ul>

      <h2>See Also</h2>
      <ul>
        <li><a href="../../PLUGINS.md">Plugin Development Guide</a> - General plugin documentation</li>
        <li><a href="https://hyprland.org/">Hyprland Website</a> - Official Hyprland site</li>
        <li><a href="https://wiki.hyprland.org/">Hyprland Wiki</a> - Complete configuration reference</li>
      </ul>
    </div>
  </div>
</body>
</html>
